IF ISNULL(@SITEID,'')=''
BEGIN
IF EXISTS(SELECT 1 FROM ROLES R INNER JOIN USERINFO UR ON UR.USERID=@USERID AND UR.DEFAULTROLEID =R.ROLEID AND R.ALLSITES=1 WHERE R.ROLEID = @ROLEID)
SELECT DISTINCT CHECKLISTSETUPID,SETUPNAME+CASE WHEN STATUS =0 THEN '( InActive )' ELSE '' END SETUPNAME FROM CHECKLISTSETUP
WHERE STATUS IN (0,1)
ORDER BY SETUPNAME
ELSE
SELECT CHECKLISTSETUPID,SETUPNAME FROM(
SELECT DISTINCT CS.CHECKLISTSETUPID,CS.SETUPNAME+CASE WHEN CS.STATUS =0 THEN '( InActive )' ELSE '' END SETUPNAME FROM CHECKLISTSETUP CS
INNER JOIN CHECKLISTSETUPSITES CSS ON CSS.CHECKLISTSETUPID=CS.CHECKLISTSETUPID
INNER JOIN USERSITES US ON US.SITEID = CSS.SITEID AND US.USERID = @USERID
WHERE CSS.STATUS=1 AND CS.STATUS IN(0,1) AND US.STATUS = 1
UNION
SELECT DISTINCT CHECKLISTSETUPID,SETUPNAME+CASE WHEN STATUS =0 THEN '( InActive )' ELSE '' END SETUPNAME FROM CHECKLISTSETUP
WHERE STATUS IN (0,1) AND ALLSITES=1)A
ORDER BY SETUPNAME
END
ELSE
SELECT CHECKLISTSETUPID,SETUPNAME FROM
(SELECT DISTINCT CS.CHECKLISTSETUPID,CS.SETUPNAME+CASE WHEN CS.STATUS =0 THEN '( InActive )' ELSE '' END SETUPNAME FROM CHECKLISTSETUP CS
INNER JOIN CHECKLISTSETUPSITES CSS ON CSS.CHECKLISTSETUPID=CS.CHECKLISTSETUPID
INNER JOIN DBO.CSVtoTable(@SITEID) S ON S.RESULT=CSS.SITEID
WHERE  CSS.STATUS=1 AND CS.STATUS IN(0,1)
UNION
SELECT DISTINCT CHECKLISTSETUPID,SETUPNAME+CASE WHEN STATUS =0 THEN '( InActive )' ELSE '' END SETUPNAME FROM CHECKLISTSETUP
WHERE STATUS IN (0,1) AND ALLSITES=1) A
ORDER BY SETUPNAME