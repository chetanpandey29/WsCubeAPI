DECLARE @CC_TIMESTAMP DATETIME
SET @CC_TIMESTAMP=GETDATE()

IF EXISTS ( SELECT 1 FROM REDFLAGS WHERE REDFLAGNAME=@REDFLAGNAME AND REDFLAGID!=@REDFLAGID AND [STATUS]!=2) SELECT '-1'
ELSE
BEGIN
UPDATE [REDFLAGS]
SET
[REDFLAGNAME] = @REDFLAGNAME
,[MAINCATEGORYID] = @MAINCATEGORYID
,[SUBCATEGORYID] = @SUBCATEGORYID
,[AREAID] = @AREAID
,[SUBAREAID] = @SUBAREAID
,[OBSERVERID] = @OBSERVERID
,[METRIC] = @METRIC
,[TRIGGER] = @TRIGGER
,[VALUE] = @VALUE
,[CHECKLISTSETUPID] = @CARDVERSIONID
,[STATUS] = @STATUS
,[UPDATEDBY] = @UPDATEDBY
,[UPDATEDDATE] = @CC_TIMESTAMP
WHERE REDFLAGID = @REDFLAGID
SELECT 1
END

INSERT INTO dbo.AUDIT(TABLENAME,TRANS,STAMP,LASTUPDATEDBY,DATA)
SELECT 'REDFLAGS','UPDATE-UPDATEREDFLAG_1.0',@CC_TIMESTAMP,@UPDATEDBY,NULL