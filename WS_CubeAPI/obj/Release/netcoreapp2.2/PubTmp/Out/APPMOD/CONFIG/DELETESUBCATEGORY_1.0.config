--DELETESUBCATEGORY_1.0
DECLARE @CC_TIMESTAMP DATETIME
SET @CC_TIMESTAMP=GETDATE()
DELETE FROM [CHECKLISTSETUPCATEGORYASSIGNMENTS]  WHERE SUBCATEGORYID IN (SELECT RESULT FROM DBO.CSVTOTABLE(@SUBCATEGORYID))

UPDATE [CORRECTIVEACTIONSCATEGORY] SET STATUS=2,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=GETDATE() WHERE SUBCATEGORYID IN (SELECT RESULT FROM DBO.CSVTOTABLE(@SUBCATEGORYID))

UPDATE [STOPCARDENTRYOBSERVATIONS] SET STATUS=2,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=GETDATE() WHERE SUBCATEGORYID IN (SELECT RESULT FROM DBO.CSVTOTABLE(@SUBCATEGORYID))

UPDATE [STOPCARDENTRYATTACHMENTS] SET STATUS=2,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=GETDATE() WHERE SUBCATEGORYID IN (SELECT RESULT FROM DBO.CSVTOTABLE(@SUBCATEGORYID))

UPDATE [SUBCATEGORIES] SET STATUS = 2,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=GETDATE() WHERE  SUBCATEGORYID IN (SELECT RESULT FROM DBO.CSVTOTABLE(@SUBCATEGORYID))

UPDATE [REDFLAGS] SET STATUS = 2,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=GETDATE() WHERE  SUBCATEGORYID IN (SELECT RESULT FROM DBO.CSVTOTABLE(@SUBCATEGORYID))

UPDATE ENTITYTRANSLATION SET STATUS = 2,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=GETDATE() WHERE PARENTID = @MAINCATEGORYID AND ENTITYID IN (SELECT RESULT FROM DBO.CSVTOTABLE(@SUBCATEGORYID)) AND ENTITYTYPE='SUB_CTG'

--OL
UPDATE [STOPCARDENTRYOBSERVATIONS_OL] SET STATUS=2,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=GETDATE() WHERE SUBCATEGORYID IN (SELECT RESULT FROM DBO.CSVTOTABLE(@SUBCATEGORYID))

UPDATE [STOPCARDENTRYATTACHMENTS_OL] SET STATUS=2,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=GETDATE() WHERE SUBCATEGORYID IN (SELECT RESULT FROM DBO.CSVTOTABLE(@SUBCATEGORYID))

SELECT @MAINCATEGORYID


INSERT INTO dbo.AUDIT(TABLENAME,TRANS,STAMP,LASTUPDATEDBY,DATA)
SELECT 'CHECKLISTSETUPCATEGORYASSIGNMENTS/CORRECTIVEACTIONSCATEGORY/STOPCARDENTRYOBSERVATIONS/STOPCARDENTRYATTACHMENTS/SUBCATEGORIES/REDFLAGS/ENTITYTRANSLATION','DELETE-DELETESUBCATEGORY_1.0',@CC_TIMESTAMP,@UPDATEDBY,NULL
