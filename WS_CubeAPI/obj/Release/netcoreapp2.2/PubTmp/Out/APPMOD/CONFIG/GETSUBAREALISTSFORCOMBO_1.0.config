--GETSUBAREALISTSFORCOMBO_1.0

IF @MODE=0
BEGIN
IF @AREAID='-1'
SELECT SA.SUBAREAID,SA.SUBAREANAME FROM SUBAREAS SA
WHERE SA.STATUS =1
ORDER BY SUBAREANAME
ELSE
SELECT SA.SUBAREAID,SA.SUBAREANAME FROM SUBAREAS SA
INNER JOIN SUBAREASMAP SM ON SM.SUBAREAID=SA.SUBAREAID
WHERE SA.STATUS =1 AND SM.STATUS=1 AND SM.AREAID=@AREAID
ORDER BY SUBAREANAME
END
ELSE
BEGIN
IF @AREAID='-1'
SELECT DISTINCT  S.SUBAREAID,S.SUBAREANAME+CASE WHEN S.STATUS =0 THEN '( InActive )' ELSE '' END SUBAREANAME FROM SUBAREAS S
WHERE S.STATUS IN(0, 1)
ORDER BY SUBAREANAME
ELSE
SELECT DISTINCT  S.SUBAREAID,S.SUBAREANAME+CASE WHEN S.STATUS =0 THEN '( InActive )' WHEN EXISTS(SELECT 1 FROM SUBAREASMAP WHERE AREAID=@AREAID AND SUBAREAID=S.SUBAREAID AND STATUS=0) THEN ' ( Unassigned )' ELSE '' END SUBAREANAME FROM SUBAREAS S
INNER JOIN SUBAREASMAP SA ON SA.SUBAREAID = S.SUBAREAID
INNER JOIN AREAS A ON A.AREAID=SA.AREAID
WHERE A.STATUS IN(0,1) AND S.STATUS IN(0, 1) AND SA.STATUS IN (0,1) AND SA.AREAID=@AREAID
ORDER BY SUBAREANAME
END



