IF ISNULL(@SITEID,'')=''
BEGIN
IF @ROLEID=1
BEGIN
SELECT AREAID,AREANAME FROM AREAS WHERE STATUS = 1
ORDER BY AREANAME
END
ELSE
BEGIN
SELECT DISTINCT A.AREAID,A.AREANAME FROM AREAS A
INNER JOIN SITEAREAS SA ON SA.AREAID = A.AREAID
INNER JOIN SITES S ON S.SITEID = SA.SITEID
INNER JOIN USERSITES US ON US.SITEID = S.SITEID AND US.USERID = @USERID
WHERE A.STATUS = 1 AND SA.STATUS = 1 AND S.STATUS = 1 AND US.STATUS = 1
ORDER BY AREANAME
END

END
ELSE
BEGIN
SELECT DISTINCT  A.AREAID,A.AREANAME FROM AREAS A
INNER JOIN SITEAREAS SA ON SA.AREAID = A.AREAID
INNER JOIN SITES S ON S.SITEID = SA.SITEID
INNER JOIN USERSITES US ON US.SITEID = S.SITEID AND US.USERID = @USERID
INNER JOIN dbo.CSVtoTable(@SITEID) R ON R.RESULT=S.SITEID
WHERE A.STATUS = 1 AND SA.STATUS = 1 AND S.STATUS = 1 AND US.STATUS = 1
ORDER BY AREANAME
END
