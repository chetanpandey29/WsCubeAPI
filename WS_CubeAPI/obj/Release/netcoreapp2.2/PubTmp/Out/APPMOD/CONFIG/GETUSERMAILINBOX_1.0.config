DECLARE @QRY VARCHAR(MAX)
SET @QRY=''
SET @QRY='SELECT ID,[FROM],[TO],[CC],[SUBJECT],BODY,[SUBJECT],BODY,CONVERT(VARCHAR(10), SENTDATE, '+CAST(@DFORMAT AS VARCHAR(8))+')SENTDATE,CASE WHEN READSTATUS = 0 THEN ''LBLUNREAD'' ELSE ''LBLREAD'' END MAILREADSTATUS,SENTDATE DT FROM USERINBOX UI'
+' WHERE STATUS = 1 AND USERID='+CAST(@USERID AS VARCHAR(8))
+CASE WHEN ISNULL(@READSTATUS,'')='' THEN '' ELSE ' AND READSTATUS IN ('+@READSTATUS +')' END
+CASE WHEN ISNULL(@TYPE,'')='' THEN '' ELSE ' AND [TYPE] IN ('+@TYPE+')' END
+' ORDER BY DT DESC'
EXEC(@QRY)