--GETUSERSASSGFORGROUPS_1.0
IF EXISTS(SELECT 1 FROM USERINFO WHERE DEFAULTROLEID=1 AND USERID = @USERID)

SELECT '<option value="'+CAST(U.USERID AS VARCHAR(32))+'">'+U.LASTNAME + ' , ' + U.FIRSTNAME+ CASE WHEN U.STATUS=0 THEN '( InActive )' WHEN U.STATUS=4 THEN '( Locked )' ELSE '' END+'</option>' AS 'data()'
FROM USERS U
INNER JOIN USERGROUPS UG ON UG.USERID = U.USERID
WHERE GROUPTYPEID = @GROUPTYPEID AND GROUPID = @GROUPID AND UG.STATUS= 1 AND U.STATUS IN(0,1,4) AND U.USERID !=@USERID ORDER BY U.LASTNAME + ' , ' + U.FIRSTNAME FOR XML PATH('')

ELSE

SELECT '<option value="'+CAST(U.USERID AS VARCHAR(32))+'">'+U.LASTNAME + ' , ' + U.FIRSTNAME+ CASE WHEN U.STATUS=0 THEN '( InActive )' WHEN U.STATUS=4 THEN '( Locked )' ELSE '' END+'</option>' AS 'data()'
FROM USERS U
INNER JOIN USERSITES US ON US.USERID = U.USERID
INNER JOIN USERGROUPS UG ON UG.USERID = U.USERID
WHERE US.STATUS =1 AND GROUPTYPEID = @GROUPTYPEID AND GROUPID = @GROUPID AND UG.STATUS= 1 AND U.STATUS IN(0,1,4)
AND US.SITEID IN (SELECT SITEID FROM USERSITES WHERE USERID = @USERID AND STATUS =1)
AND U.USERID !=@USERID
ORDER BY U.LASTNAME + ' , ' + U.FIRSTNAME FOR XML PATH('')
