DECLARE @CC_TIMESTAMP DATETIME
SET @CC_TIMESTAMP=GETDATE()

UPDATE USERROLES SET STATUS = 1,UPDATEDBY = @UPDATEDBY,UPDATEDDATE = @CC_TIMESTAMP
WHERE [STATUS] = 0 AND USERID =@USERID AND  ROLEID IN (SELECT RESULT FROM DBO.CSVtoTable(@ROLEID));
INSERT INTO USERROLES(USERID,ROLEID,STATUS,UPDATEDBY,UPDATEDDATE)
SELECT @USERID,RESULT,1,@UPDATEDBY,@CC_TIMESTAMP FROM DBO.CSVtoTable(@ROLEID)
WHERE RESULT NOT IN (SELECT ROLEID FROM USERROLES WHERE USERID =@USERID);
UPDATE USERROLES SET STATUS = 0,UPDATEDBY = @UPDATEDBY,UPDATEDDATE = @CC_TIMESTAMP
WHERE [STATUS] = 0 AND USERID =@USERID AND  ROLEID NOT IN (SELECT RESULT FROM DBO.CSVtoTable(@ROLEID))

INSERT INTO dbo.AUDIT(TABLENAME,TRANS,STAMP,LASTUPDATEDBY,DATA)
SELECT 'USERROLES','UPDATE-UPDATEUSRROLEASSGN_1.0',@CC_TIMESTAMP,@UPDATEDBY,NULL
