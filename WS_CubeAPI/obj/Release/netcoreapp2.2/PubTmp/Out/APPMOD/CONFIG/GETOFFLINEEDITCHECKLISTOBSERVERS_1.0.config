--GETOFFLINEEDITCHECKLISTOBSERVERS_1.0
SELECT '<option value="'+CAST(U.USERID AS VARCHAR(32))+'">'+LASTNAME+','+FIRSTNAME+'</option>' AS 'data()' FROM USERS U
INNER JOIN USERINFO UI ON UI.USERID = U.USERID
INNER JOIN USERSITES US ON US.USERID = U.USERID
WHERE US.SITEID = @SITEID AND U.STATUS=1 AND US.STATUS = 1 AND UI.USERTYPEID IN (1,2)
AND NOT EXISTS(SELECT 1 FROM dbo.STOPCARDENTRYOBSERVERS_OL WHERE CARDID =@CARDID AND OBSERVERID=U.USERID)
ORDER BY LASTNAME+','+FIRSTNAME FOR XML PATH('')


SELECT '<option value="'+CAST(U.USERID AS VARCHAR(32))+'">'+LASTNAME+',' +FIRSTNAME+CASE WHEN U.STATUS=0 THEN '( InActive )' WHEN EXISTS(SELECT 1 FROM USERSITES WHERE SITEID=@SITEID AND USERID=U.USERID AND STATUS=0) THEN ' ( Unassigned )' ELSE '' END+'</option>' AS 'data()' FROM USERS U
INNER JOIN STOPCARDENTRYOBSERVERS_OL SCO ON SCO.OBSERVERID = U.USERID
WHERE U.STATUS IN (0,1)  AND CARDID =@CARDID ORDER BY LASTNAME+','+FIRSTNAME FOR XML PATH('')
