DECLARE @CC_TIMESTAMP DATETIME
SET @CC_TIMESTAMP=GETDATE()

IF EXISTS(SELECT 1 FROM ENTITYTRANSLATION WHERE PARENTID=@GROUPTYPEID AND ENTITYTYPE='UGP_TYPE' AND ENTITYVALUE=@GROUPNAME AND STATUS!=2 AND LANGUAGEID=@LANGUAGEID)
SELECT -1
ELSE
BEGIN
INSERT INTO GROUPS(COMPANYID,GROUPNAME,GROUPTYPEID,[STATUS],CREATEDBY,CREATEDDATE)VALUES(@COMPANYID,@GROUPNAME,@GROUPTYPEID,@STATUS,@CREATEDBY,@CC_TIMESTAMP); SELECT @@IDENTITY

INSERT INTO ENTITYTRANSLATION(LANGUAGEID,PARENTID,ENTITYID,ENTITYNAME,ENTITYVALUE,ENTITYTYPE,CREATEDBY,CREATEDDATE,[STATUS])
SELECT LANGUAGEID,@GROUPTYPEID,@@IDENTITY,@GROUPNAME,@GROUPNAME,'UGP_TYPE',@CREATEDBY,@CC_TIMESTAMP,1 FROM LANGUAGES ORDER BY LANGUAGEID
END


INSERT INTO dbo.AUDIT(TABLENAME,TRANS,STAMP,LASTUPDATEDBY,DATA)
SELECT 'GROUPS/ENTITYTRANSLATION','INSERT-INSERTGROUPS_1.0',@CC_TIMESTAMP,@CREATEDBY,
(SELECT * FROM GROUPS WHERE CREATEDBY=@CREATEDBY AND CREATEDDATE=@CC_TIMESTAMP FOR XML AUTO)

