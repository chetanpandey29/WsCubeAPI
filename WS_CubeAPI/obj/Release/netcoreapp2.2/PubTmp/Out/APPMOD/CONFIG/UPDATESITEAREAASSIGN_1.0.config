--UPDATESITEAREAASSIGN_1.0
DECLARE @CC_TIMESTAMP DATETIME
SET @CC_TIMESTAMP=GETDATE()

CREATE TABLE #AREALIST(AREAID INT)
INSERT INTO #AREALIST(AREAID)
SELECT RESULT FROM  dbo.CSVtoTable(@AREAID)

UPDATE SA SET STATUS = 1,UPDATEDBY = @USERID,UPDATEDDATE = @CC_TIMESTAMP
FROM SITEAREAS SA
INNER JOIN #AREALIST A ON A.AREAID=SA.AREAID
WHERE SA.STATUS = 0 AND SITEID = @SITEID;

INSERT INTO SITEAREAS(SITEID,AREAID,STATUS,UPDATEDBY,UPDATEDDATE)
SELECT @SITEID,AREAID,1,@USERID,@CC_TIMESTAMP FROM #AREALIST A
WHERE
NOT EXISTS(SELECT 1 FROM SITEAREAS WHERE SITEID=@SITEID AND AREAID =A.AREAID);

UPDATE SA SET STATUS = 0,UPDATEDBY = @USERID,UPDATEDDATE = @CC_TIMESTAMP
FROM SITEAREAS SA
WHERE SITEID = @SITEID AND
NOT EXISTS(SELECT 1 FROM #AREALIST WHERE AREAID=SA.AREAID)

INSERT INTO dbo.AUDIT(TABLENAME,TRANS,STAMP,LASTUPDATEDBY,DATA)
SELECT 'SITEAREAS','UPDATE-UPDATESITEAREAASSIGN_1.0',@CC_TIMESTAMP,@USERID,NULL

DROP TABLE #AREALIST
