DECLARE @CC_TIMESTAMP DATETIME
SET @CC_TIMESTAMP=GETDATE()

UPDATE [SUBCATEGORIES] SET STATUS = CASE WHEN STATUS = 1 THEN 0 WHEN STATUS = 0 THEN 1 END,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=@CC_TIMESTAMP
WHERE SUBCATEGORYID IN (SELECT RESULT FROM DBO.CSVTOTABLE(@SUBCATEGORYID))

UPDATE ENTITYTRANSLATION SET STATUS= CASE WHEN STATUS = 1 THEN 0 WHEN STATUS = 0 THEN 1 END,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=@CC_TIMESTAMP
WHERE ENTITYID IN (SELECT RESULT FROM DBO.CSVTOTABLE(@SUBCATEGORYID)) AND PARENTID=0 AND ENTITYTYPE='SUB_CTG' AND STATUS!=2

INSERT INTO dbo.AUDIT(TABLENAME,TRANS,STAMP,LASTUPDATEDBY,DATA)
SELECT 'ENTITYTRANSLATION','UPDATE-UPDATECHECKLISTITEMSSTATUS_1.0',@CC_TIMESTAMP,@UPDATEDBY,
(SELECT * FROM ENTITYTRANSLATION WHERE UPDATEDBY=@UPDATEDBY AND UPDATEDDATE=@CC_TIMESTAMP FOR XML AUTO)

INSERT INTO dbo.AUDIT(TABLENAME,TRANS,STAMP,LASTUPDATEDBY,DATA)
SELECT 'SUBCATEGORIES','UPDATE-UPDATECHECKLISTITEMSSTATUS_1.0',@CC_TIMESTAMP,@UPDATEDBY,
(SELECT * FROM [SUBCATEGORIES] WHERE UPDATEDBY=@UPDATEDBY AND UPDATEDDATE=@CC_TIMESTAMP FOR XML AUTO)