IF @MODE=0
BEGIN
IF EXISTS(SELECT 1 FROM STOPCARDENTRY WHERE CARDID =@CARDID AND STOPCARDTYPE=1)
SELECT DISTINCT M.MAINCATEGORYID,ET.ENTITYVALUE [MAINCATEGORYNAME]
FROM STOPCARDENTRY SC
INNER JOIN CHECKLISTSETUP CS ON CS.CHECKLISTSETUPID=SC.CHECKLISTSETUPID
INNER JOIN CHECKLISTSETUPCATEGORYASSIGNMENTS CSC ON CSC.CHECKLISTSETUPID=CS.CHECKLISTSETUPID
INNER JOIN MAINCATEGORIES M ON M.MAINCATEGORYID= CSC.MAINCATEGORYID
INNER JOIN ENTITYTRANSLATION ET ON ET.PARENTID=M.MAINCATEGORYID AND LANGUAGEID=@LANGUAGEID AND ENTITYTYPE='MAIN_CTG'
WHERE  SC.CARDID=@CARDID AND M.STATUS = 1 AND M.MAINCATEGORYID <> 0 AND CSC.MAINISASSIGNED=1 AND CSC.SUBISASSIGNED=1 ORDER BY  MAINCATEGORYNAME
ELSE
SELECT MAINCATEGORYID,ENTITYVALUE [MAINCATEGORYNAME]
FROM MAINCATEGORIES M
INNER JOIN ENTITYTRANSLATION ET ON ET.PARENTID=M.MAINCATEGORYID AND LANGUAGEID=@LANGUAGEID AND ENTITYTYPE='MAIN_CTG'
WHERE  M.STATUS = 1 AND MAINCATEGORYID <> 0 ORDER BY  MAINCATEGORYNAME


END
ELSE
BEGIN
IF EXISTS(SELECT 1 FROM STOPCARDENTRY WHERE CARDID =@CARDID AND STOPCARDTYPE=1)
SELECT MAINCATEGORYID,[MAINCATEGORYNAME] FROM
(SELECT DISTINCT M.MAINCATEGORYID,ET.ENTITYVALUE+CASE WHEN M.STATUS=0 THEN '( InActive )' ELSE '' END [MAINCATEGORYNAME]
FROM STOPCARDENTRY SC
INNER JOIN CHECKLISTSETUP CS ON CS.CHECKLISTSETUPID=SC.CHECKLISTSETUPID
INNER JOIN CHECKLISTSETUPCATEGORYASSIGNMENTS CSC ON CSC.CHECKLISTSETUPID=CS.CHECKLISTSETUPID
INNER JOIN MAINCATEGORIES M ON M.MAINCATEGORYID= CSC.MAINCATEGORYID
INNER JOIN ENTITYTRANSLATION ET ON ET.PARENTID=M.MAINCATEGORYID AND LANGUAGEID=@LANGUAGEID AND ENTITYTYPE='MAIN_CTG'
WHERE  SC.CARDID=@CARDID AND  M.STATUS IN (0, 1) AND M.MAINCATEGORYID <> 0 AND CSC.MAINISASSIGNED=1 AND CSC.SUBISASSIGNED=1
AND M.MAINCATEGORYID IN (SELECT MAINCATEGORYID FROM CORRECTIVEACTIONSCATEGORY WHERE CORRACTIONID =@CORRACTIONID AND ISASSIGNED = 1)
UNION
SELECT DISTINCT M.MAINCATEGORYID,ET.ENTITYVALUE [MAINCATEGORYNAME]
FROM STOPCARDENTRY SC
INNER JOIN CHECKLISTSETUP CS ON CS.CHECKLISTSETUPID=SC.CHECKLISTSETUPID
INNER JOIN CHECKLISTSETUPCATEGORYASSIGNMENTS CSC ON CSC.CHECKLISTSETUPID=CS.CHECKLISTSETUPID
INNER JOIN MAINCATEGORIES M ON M.MAINCATEGORYID= CSC.MAINCATEGORYID
INNER JOIN ENTITYTRANSLATION ET ON ET.PARENTID=M.MAINCATEGORYID AND LANGUAGEID=@LANGUAGEID AND ENTITYTYPE='MAIN_CTG'
WHERE  SC.CARDID=@CARDID AND  M.STATUS IN (1) AND M.MAINCATEGORYID <> 0 AND CSC.MAINISASSIGNED=1 AND CSC.SUBISASSIGNED=1
AND M.MAINCATEGORYID NOT IN (SELECT MAINCATEGORYID FROM CORRECTIVEACTIONSCATEGORY WHERE CORRACTIONID =@CORRACTIONID AND ISASSIGNED = 1))A

ELSE
SELECT MAINCATEGORYID,[MAINCATEGORYNAME] FROM
(SELECT MAINCATEGORYID,ENTITYVALUE+CASE WHEN M.STATUS=0 THEN '( InActive )' ELSE '' END [MAINCATEGORYNAME]
FROM MAINCATEGORIES M
INNER JOIN ENTITYTRANSLATION ET ON ET.PARENTID=M.MAINCATEGORYID AND LANGUAGEID=@LANGUAGEID AND ENTITYTYPE='MAIN_CTG'
WHERE  M.STATUS IN (0, 1) AND MAINCATEGORYID <> 0
AND M.MAINCATEGORYID IN (SELECT MAINCATEGORYID FROM CORRECTIVEACTIONSCATEGORY WHERE CORRACTIONID =@CORRACTIONID AND ISASSIGNED = 1)
UNION
SELECT MAINCATEGORYID,ENTITYVALUE [MAINCATEGORYNAME]
FROM MAINCATEGORIES M
INNER JOIN ENTITYTRANSLATION ET ON ET.PARENTID=M.MAINCATEGORYID AND LANGUAGEID=@LANGUAGEID AND ENTITYTYPE='MAIN_CTG'
WHERE  M.STATUS IN (1) AND MAINCATEGORYID <> 0
AND M.MAINCATEGORYID NOT IN (SELECT MAINCATEGORYID FROM CORRECTIVEACTIONSCATEGORY WHERE CORRACTIONID =@CORRACTIONID AND ISASSIGNED = 1))A
END
