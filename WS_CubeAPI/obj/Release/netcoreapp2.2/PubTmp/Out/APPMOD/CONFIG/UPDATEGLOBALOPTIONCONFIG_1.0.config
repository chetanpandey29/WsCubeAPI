DECLARE @CC_TIMESTAMP DATETIME
SET @CC_TIMESTAMP=GETDATE()

UPDATE L SET STATUS= 1,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=@CC_TIMESTAMP
FROM LANGUAGES L
INNER JOIN DBO.CSVTOTABLE(@LANGUAGEID) LL ON LL.RESULT=L.LANGUAGEID

UPDATE LANGUAGES SET STATUS = 0,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=@CC_TIMESTAMP WHERE LANGUAGEID NOT IN (SELECT RESULT FROM DBO.CSVTOTABLE(@LANGUAGEID)) AND STATUS!=2

UPDATE LANGUAGES SET STATUS = 1,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=@CC_TIMESTAMP WHERE LANGUAGEID IN (SELECT LANGUAGEID FROM USERINFO UI INNER JOIN USERS U ON U.USERID =UI.USERID WHERE U.STATUS!=2)


UPDATE GT SET STATUS= 1,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=@CC_TIMESTAMP
FROM GROUPTYPES GT
INNER JOIN DBO.CSVTOTABLE(@GROUPTYPEID) GL ON GL.RESULT=GT.GROUPTYPEID

UPDATE GROUPTYPES SET STATUS = 0,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=@CC_TIMESTAMP WHERE GROUPTYPEID NOT IN (SELECT RESULT FROM DBO.CSVTOTABLE(@GROUPTYPEID))

UPDATE REPORTOPTIONSMASTER SET STATUS = 1 WHERE RELATIONID IN (SELECT GROUPTYPEID FROM GROUPTYPES WHERE STATUS =1) AND OPTIONSCATEGORYID=2
UPDATE REPORTOPTIONSMASTER SET STATUS = 0 WHERE RELATIONID IN (SELECT GROUPTYPEID FROM GROUPTYPES WHERE STATUS =0) AND OPTIONSCATEGORYID=2

UPDATE RO SET STATUS = 1
FROM REPORTSOPTION RO
INNER JOIN REPORTOPTIONSMASTER ROM ON ROM.OPTIONID=RO.OPTIONID
WHERE ROM.STATUS = 1 AND ROM.OPTIONID BETWEEN 22 AND 31

UPDATE RO SET STATUS = 0
FROM REPORTSOPTION RO
INNER JOIN REPORTOPTIONSMASTER ROM ON ROM.OPTIONID=RO.OPTIONID
WHERE ROM.STATUS = 0 AND ROM.OPTIONID BETWEEN 22 AND 31


UPDATE ST SET STATUS=1
FROM SCHEDULETYPES ST
INNER JOIN DBO.CSVTOTABLE(@SCHEDULETYPEID) SL ON SL.RESULT=ST.SCHEDULETYPEID

UPDATE SCHEDULETYPES SET STATUS=0 WHERE SCHEDULETYPEID NOT IN(SELECT RESULT FROM DBO.CSVTOTABLE(@SCHEDULETYPEID)) AND SCHEDULETYPEID NOT IN(5,6,9,10,11)

UPDATE SCHEDULETYPES SET STATUS=3 WHERE  SCHEDULETYPEID IN(9,10)

UPDATE COMPANYOPTIONS SET OPTIONVALUE=(SELECT INTERNALNAME FROM LANGUAGES WHERE LANGUAGEID=@DEFAULTLANGUAGEID),UPDATEDBY=@UPDATEDBY,UPDATEDDATE=@CC_TIMESTAMP
WHERE OPTIONNAME='Languages'


UPDATE TZ SET STATUS=1
FROM TIMEZONES TZ
INNER JOIN DBO.CSVTOTABLE(@TIMEZONEID) TL ON TL.RESULT=TZ.TIMEZONEID

UPDATE TIMEZONES SET STATUS=0 WHERE TIMEZONEID NOT IN(SELECT RESULT FROM DBO.CSVTOTABLE(@TIMEZONEID))

UPDATE TIMEZONES SET STATUS = 1 WHERE TIMEZONEID IN (SELECT TIMEZONE FROM USERINFO UI INNER JOIN USERS U ON U.USERID =UI.USERID WHERE U.STATUS!=2)

UPDATE COMPANYOPTIONS SET OPTIONVALUE=@DEFAULTTIMEZONEID,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=@CC_TIMESTAMP WHERE OPTIONNAME='Timezone'

SELECT 2


INSERT INTO dbo.AUDIT(TABLENAME,TRANS,STAMP,LASTUPDATEDBY,DATA)
SELECT '','UPDATE-UPDATEGLOBALOPTIONCONFIG_1.0',@CC_TIMESTAMP,@UPDATEDBY,NULL
