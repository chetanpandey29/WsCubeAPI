DECLARE @AS_TIMESTAMP DATETIME
SET @AS_TIMESTAMP=GETDATE()

UPDATE SUBAREASMAP SET STATUS =1,CREATEDBY = @USERID,CREATEDDATE = @AS_TIMESTAMP WHERE AREAID = @AREAID AND SUBAREAID IN (SELECT RESULT FROM DBO.CSVtoTable(@SUBAREAID))
INSERT INTO SUBAREASMAP(AREAID,SUBAREAID,STATUS,CREATEDBY,CREATEDDATE)
SELECT @AREAID,RESULT,1,@USERID,@AS_TIMESTAMP
FROM DBO.CSVtoTable(@SUBAREAID)
WHERE RESULT NOT IN (SELECT SUBAREAID FROM SUBAREASMAP WHERE SUBAREAID IN (SELECT RESULT FROM DBO.CSVtoTable(@SUBAREAID)) AND AREAID = @AREAID)
UPDATE SUBAREASMAP SET STATUS =0,CREATEDBY = @USERID,CREATEDDATE = @AS_TIMESTAMP WHERE AREAID = @AREAID AND SUBAREAID NOT IN (SELECT RESULT FROM DBO.CSVtoTable(@SUBAREAID))


INSERT INTO dbo.AUDIT(TABLENAME,TRANS,STAMP,LASTUPDATEDBY,DATA)
SELECT 'SUBAREASMAP','UPDATE-UPDATEAREASUBAREAS_1.0',@AS_TIMESTAMP,@USERID,(SELECT * FROM SUBAREASMAP WHERE CREATEDBY=@USERID AND CREATEDDATE=@AS_TIMESTAMP  FOR XML AUTO)
