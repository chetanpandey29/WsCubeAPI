--GETAREAMANAGERAREALIST_1.0

SELECT A.AREAID,A.AREANAME FROM AREAS A
INNER JOIN SITEAREAS SA ON SA.AREAID=A.AREAID
WHERE A.STATUS=1 AND SA.STATUS=1 AND SA.SITEID=@SITEID
ORDER BY AREANAME


--GETUSERSAVAILTOSITE_1.0
CREATE TABLE #ASSGNEDUSERS (USERID INT,FULLNAME NVARCHAR(512))
CREATE TABLE #AVAILABLEUSERS (USERID INT,FULLNAME NVARCHAR(512))

INSERT INTO #ASSGNEDUSERS
SELECT DISTINCT U.USERID,U.LASTNAME + ',' + U.FIRSTNAME+CASE WHEN U.[STATUS] = 0 THEN ' ( InActive ) ' WHEN U.[STATUS] = 4 THEN ' ( Locked ) '  ELSE '' END AS [FULLNAME]
FROM USERS U
INNER JOIN SITEAREAMANAGERS SA ON SA.USERID=U.USERID
WHERE U.STATUS <> 2 AND SA.SITEID=@SITEID AND SA.AREAID=@AREAID

INSERT INTO #AVAILABLEUSERS
SELECT DISTINCT U.USERID,U.LASTNAME + ',' + U.FIRSTNAME [FULLNAME]  FROM USERS U
INNER JOIN USERINFO UI ON UI.USERID=U.USERID
INNER JOIN USERSITES US ON US.USERID=U.USERID
WHERE U.STATUS=1 AND US.SITEID=@SITEID AND US.STATUS=1 AND UI.USERTYPEID IN (0,2)
AND NOT EXISTS(SELECT 1 FROM #ASSGNEDUSERS A WHERE A.USERID=U.USERID)
ORDER BY FULLNAME


SELECT '<option value="'+CAST(USERID AS VARCHAR(32))+'">'+FULLNAME+'</option>' AS 'data()' FROM #AVAILABLEUSERS ORDER BY FULLNAME FOR XML PATH('')
SELECT '<option value="'+CAST(USERID AS VARCHAR(32))+'">'+FULLNAME+'</option>' AS 'data()' FROM #ASSGNEDUSERS ORDER BY FULLNAME FOR XML PATH('')

DROP TABLE #AVAILABLEUSERS
DROP TABLE #ASSGNEDUSERS


