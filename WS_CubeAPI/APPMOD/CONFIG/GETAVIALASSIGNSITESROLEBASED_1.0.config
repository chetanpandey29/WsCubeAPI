--GETAVIALASSIGNSITESROLEBASED_1.0
IF @ROLEID = 1
BEGIN

SELECT '<option value="'+CAST(SITEID AS VARCHAR(32))+'">'+SITENAME+'</option>' AS 'data()'  FROM SITES S
WHERE SITEID NOT IN (SELECT SITEID FROM SITEINJURYSTATS WHERE INJURYID=@INJURYID AND STATUS=1)
AND S.STATUS = 1
ORDER BY SITENAME FOR XML PATH('') 

SELECT '<option value="'+CAST(SITEID AS VARCHAR(32))+'">'+[SITENAME] + CASE WHEN S.STATUS=0 THEN '( InActive )' ELSE '' END+'</option>' AS 'data()'  FROM SITES S
WHERE SITEID IN (SELECT SITEID FROM SITEINJURYSTATS WHERE INJURYID=@INJURYID AND STATUS=1)
AND S.STATUS IN(0,1)
ORDER BY SITENAME FOR XML PATH('') 

END
ELSE
BEGIN

SELECT '<option value="'+CAST(S.SITEID AS VARCHAR(32))+'">'+S.SITENAME+'</option>' AS 'data()'  FROM SITES S
INNER JOIN USERSITES US ON US.SITEID = S.SITEID
WHERE US.USERID=@USERID AND US.STATUS = 1 AND S.SITEID NOT IN (SELECT SITEID FROM SITEINJURYSTATS WHERE INJURYID=@INJURYID AND STATUS=1)
AND S.STATUS = 1
ORDER BY SITENAME FOR XML PATH('') 

SELECT '<option value="'+CAST(S.SITEID AS VARCHAR(32))+'">'+[SITENAME] + CASE WHEN S.STATUS=0 THEN '( InActive )' ELSE '' END+'</option>' AS 'data()'  FROM SITES S
INNER JOIN USERSITES US ON US.SITEID = S.SITEID AND US.USERID=@USERID
WHERE S.SITEID IN (SELECT SITEID FROM SITEINJURYSTATS WHERE INJURYID=@INJURYID AND STATUS=1)
AND S.STATUS IN(0,1)
ORDER BY SITENAME FOR XML PATH('') 
END