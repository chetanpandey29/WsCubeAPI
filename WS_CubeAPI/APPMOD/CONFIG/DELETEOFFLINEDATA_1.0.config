--DELETEOFFLINEDATA_1.0
DECLARE @CC_TIMESTAMP DATETIME
SET @CC_TIMESTAMP=GETDATE()

DECLARE @INPUTCARDLIST TABLE(CARDID INT,ISEDIT INT)

INSERT INTO @INPUTCARDLIST(CARDID,ISEDIT)
SELECT R.RESULT,CASE WHEN EDITOR=1 THEN 1 ELSE 0 END FROM dbo.CSVTOTABLE(@CARDID) R
INNER JOIN STOPCARDENTRY_OL SC ON SC.CARDID=R.RESULT

UPDATE [STOPCARDENTRYATTACHMENTS_OL] SET STATUS = 2,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=@CC_TIMESTAMP WHERE CARDID IN (SELECT CARDID FROM @INPUTCARDLIST WHERE ISEDIT=0)
UPDATE [STOPCARDENTRYOBSERVATIONS_OL] SET STATUS = 2,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=@CC_TIMESTAMP WHERE CARDID IN (SELECT CARDID FROM @INPUTCARDLIST WHERE ISEDIT=0)
UPDATE [STOPCARDENTRY_OL] SET STATUS = 2,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=@CC_TIMESTAMP WHERE CARDID IN (SELECT CARDID FROM @INPUTCARDLIST WHERE ISEDIT=0)
UPDATE STOPCARDENTRYOBSERVERS_OL SET STATUS = 2,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=@CC_TIMESTAMP WHERE CARDID IN (SELECT CARDID FROM @INPUTCARDLIST WHERE ISEDIT=0)
UPDATE STOPCARDENTRYCUSTOMFIELDS_OL SET STATUS = 2,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=@CC_TIMESTAMP WHERE CARDID IN (SELECT CARDID FROM @INPUTCARDLIST WHERE ISEDIT=0)

SELECT (SELECT COUNT(*) FROM @INPUTCARDLIST) [TOTALCOUNT],(SELECT COUNT(*) FROM @INPUTCARDLIST WHERE ISEDIT=0) [APPROVEDCOUNT],(SELECT COUNT(*) FROM @INPUTCARDLIST WHERE ISEDIT=1) [EDITCOUNT]

INSERT INTO dbo.AUDIT(TABLENAME,TRANS,STAMP,LASTUPDATEDBY,DATA)
SELECT 'STOPCARDENTRYATTACHMENTS_OL/STOPCARDENTRYOBSERVATIONS_OL/STOPCARDENTRY_OL/STOPCARDENTRYOBSERVERS_OL','DELETE-DELETEOFFLINEDATA_1.0',@CC_TIMESTAMP,@UPDATEDBY,NULL
