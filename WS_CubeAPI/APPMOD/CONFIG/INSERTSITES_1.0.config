DECLARE @CC_TIMESTAMP DATETIME
SET @CC_TIMESTAMP=GETDATE()

DECLARE @SITEID INT
IF EXISTS ( SELECT 1 FROM SITES WHERE SITENAME=@SITENAME  AND [STATUS]!=2)
BEGIN
SELECT -1
END
ELSE
BEGIN
INSERT INTO SITES(COMPANYID,SITENAME,[ADDRESS],[CITY],[STATE],[ZIPCODE],COUNTRYID,COMMENTS,[STATUS],ISDEFAULT,EMPCOUNT,CREATEDBY,CREATEDDATE,TIMEZONEID)VALUES(@COMPANYID,@SITENAME,@ADDRESS,@CITY,@STATE,@ZIPCODE,@COUNTRYID,@COMMENTS,@STATUS,0,@EMPCOUNT,@CREATEDBY,@CC_TIMESTAMP,@TIMEZONEID);
SELECT @SITEID=@@IDENTITY
IF EXISTS(SELECT 1 FROM USERINFO WHERE USERID = @CREATEDBY AND DEFAULTROLEID !=1)
INSERT INTO USERSITES (USERID,SITEID,STATUS,UPDATEDBY,UPDATEDDATE)
SELECT @CREATEDBY,@SITEID,1,@CREATEDBY,@CC_TIMESTAMP
SELECT @SITEID

END


INSERT INTO dbo.AUDIT(TABLENAME,TRANS,STAMP,LASTUPDATEDBY,DATA)
SELECT 'SITES/USERSITES','INSERT-INSERTSITES_1.0',@CC_TIMESTAMP,@CREATEDBY,
(SELECT * FROM SITES WHERE CREATEDBY=@CREATEDBY AND CREATEDDATE=@CC_TIMESTAMP FOR XML AUTO)



