--GETSITEADMINFORLOGGEDUSER_1.0
SELECT USERID,USERNAME,EMAIL,ROLENAME FROM
(SELECT U.USERID, U.LASTNAME+' '+ U.FIRSTNAME USERNAME,U.EMAIL,R.ROLENAME
FROM USERS U
INNER JOIN USERINFO UI ON UI.USERID=U.USERID
INNER JOIN USERSITES US ON US.USERID=UI.USERID
INNER JOIN ROLES R ON R.ROLEID=UI.DEFAULTROLEID
WHERE US.STATUS =1 AND U.STATUS =1 AND US.SITEID = (SELECT DEFAULTSITEID FROM USERINFO WHERE USERID = @USERID) AND UI.DEFAULTROLEID IN (1,2)
UNION ALL
SELECT U.USERID, U.LASTNAME+' '+ U.FIRSTNAME,U.EMAIL,R.ROLENAME
FROM USERS U
INNER JOIN USERINFO UI ON UI.USERID=U.USERID
INNER JOIN USERSITES US ON US.USERID=UI.USERID
INNER JOIN ROLES R ON R.ROLEID=UI.DEFAULTROLEID
WHERE US.STATUS =1 AND U.STATUS =1 AND US.SITEID = (SELECT DEFAULTSITEID FROM USERINFO WHERE USERID = @USERID) AND UI.DEFAULTROLEID IN (SELECT ROLEID FROM ROLES WHERE STATUS=1 AND COPYFROM IN (1,2))
) A ORDER BY USERNAME