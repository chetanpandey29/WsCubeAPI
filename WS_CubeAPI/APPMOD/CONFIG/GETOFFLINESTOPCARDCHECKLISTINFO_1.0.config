--GETOFFLINESTOPCARDCHECKLISTINFO_1.0
UPDATE STOPCARDENTRY_OL SET EDITOR=2,EDITORTIMESTAMP=GETDATE() WHERE CARDID=@CARDID AND EDITOR IS NULL

SELECT
SC.[SITEID],[SITENAME] + CASE WHEN S.STATUS=0 THEN '( InActive )' ELSE '' END SITENAME
,CONVERT(VARCHAR(32),[OBSERVATIONDATE],101)[OBSERVATIONDATE]
,SC.[CHECKLISTSETUPID]
,[SETUPNAME] + CASE WHEN CS.STATUS=0 THEN '( InActive )' WHEN EXISTS(SELECT 1 FROM CHECKLISTSETUPSITES WHERE SITEID=SC.SITEID AND CHECKLISTSETUPID=SC.CHECKLISTSETUPID AND STATUS=0) THEN ' ( Unassigned )' ELSE '' END [SETUPNAME]
,[AREAID]
,[SUBAREAID]
,[SHIFTID]
,[LENGTH]
,[PEOPLECONTACTED]
,[PEOPLEOBSERVED]
,[SAFECOMMENTS]
,[UNSAFECOMMENTS]
,SC.[STATUS]
,CASE WHEN EXISTS(SELECT 1 FROM STOPCARDENTRYCUSTOMFIELDS_OL WHERE CARDID=@CARDID) THEN 1 ELSE 0 END [CUSTOMFIELDEXIST]
,CS.ENABLESAFEUNSAFE
FROM [STOPCARDENTRY_OL]SC
INNER JOIN SITES S
ON SC.SITEID = S.SITEID
INNER JOIN CHECKLISTSETUP CS
ON SC.CHECKLISTSETUPID = CS.CHECKLISTSETUPID
WHERE CARDID = @CARDID
