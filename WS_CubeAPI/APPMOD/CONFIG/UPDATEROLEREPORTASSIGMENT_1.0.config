DECLARE @CC_TIMESTAMP DATETIME
SET @CC_TIMESTAMP=GETDATE()

UPDATE ROLEREPORTS SET STATUS= 1,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=@CC_TIMESTAMP
WHERE ROLEID = @ROLEID AND REPORTID IN (SELECT RESULT FROM DBO.CSVTOTABLE(@REPORTID))

UPDATE ROLEREPORTS SET STATUS= 0,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=@CC_TIMESTAMP
WHERE ROLEID = @ROLEID AND REPORTID NOT IN (SELECT RESULT FROM DBO.CSVTOTABLE(@REPORTID))

INSERT INTO ROLEREPORTS(ROLEID,REPORTID,STATUS,UPDATEDBY,UPDATEDDATE)
SELECT @ROLEID,RESULT,1,@UPDATEDBY,@CC_TIMESTAMP FROM DBO.CSVTOTABLE(@REPORTID)
WHERE RESULT NOT IN (SELECT REPORTID FROM ROLEREPORTS WHERE ROLEID = @ROLEID);SELECT 2


INSERT INTO dbo.AUDIT(TABLENAME,TRANS,STAMP,LASTUPDATEDBY,DATA)
SELECT 'ROLEREPORTS','UPDATE-UPDATEROLEREPORTASSIGMENT_1.0',@CC_TIMESTAMP,@UPDATEDBY,NULL
--(SELECT * FROM ROLEREPORTS WHERE UPDATEDBY=@UPDATEDBY AND CREATEDDATE=@CC_TIMESTAMP FOR XML AUTO)
