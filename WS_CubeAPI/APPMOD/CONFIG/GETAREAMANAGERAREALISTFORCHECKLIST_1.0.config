--GETAREAMANAGERAREALISTFORCHECKLIST_1.0

IF @MODE=0
BEGIN
SELECT  DISTINCT U.USERID,U.LASTNAME + ',' + U.FIRSTNAME  FROM USERS U
INNER JOIN USERINFO UI ON UI.USERID = U.USERID
INNER JOIN USERSITES US ON US.USERID = U.USERID
INNER JOIN SITEAREAMANAGERS SA ON SA.USERID=US.USERID
WHERE US.SITEID = @SITEID AND U.STATUS IN(1,4) AND US.STATUS = 1 AND UI.USERTYPEID IN (0,2) AND SA.SITEID=@SITEID AND SA.AREAID = @AREAID
ORDER BY LASTNAME+','+FIRSTNAME
END
ELSE
BEGIN
SELECT DISTINCT U.USERID,U.LASTNAME + ',' + U.FIRSTNAME+CASE WHEN U.[STATUS] = 0 THEN ' ( InActive ) ' WHEN U.[STATUS] = 4 THEN ' ( Locked ) ' WHEN EXISTS(SELECT 1 FROM USERSITES WHERE SITEID=@SITEID AND USERID=U.USERID AND STATUS=0) THEN ' ( Unassigned )'  ELSE '' END AS [FULLNAME]
FROM USERS U
INNER JOIN SITEAREAMANAGERS SA ON SA.USERID=U.USERID
WHERE U.STATUS <> 2 AND SA.SITEID=@SITEID AND SA.AREAID=@AREAID
END

IF @MODE=0
BEGIN
SELECT SA.SUBAREAID,SA.SUBAREANAME FROM SUBAREAS SA
INNER JOIN SUBAREASMAP SM ON SM.SUBAREAID=SA.SUBAREAID
WHERE SA.STATUS =1 AND SM.STATUS=1 AND SM.AREAID=@AREAID
ORDER BY SUBAREANAME
END
ELSE
BEGIN
SELECT DISTINCT  S.SUBAREAID,S.SUBAREANAME+CASE WHEN S.STATUS =0 THEN '( InActive )' WHEN EXISTS(SELECT 1 FROM SUBAREASMAP WHERE AREAID=@AREAID AND SUBAREAID=S.SUBAREAID AND STATUS=0) THEN ' ( Unassigned )' ELSE '' END SUBAREANAME FROM SUBAREAS S
INNER JOIN SUBAREASMAP SA ON SA.SUBAREAID = S.SUBAREAID
INNER JOIN AREAS A ON A.AREAID=SA.AREAID
WHERE A.STATUS IN(0,1) AND S.STATUS IN(0, 1) AND SA.STATUS IN(0, 1) AND SA.AREAID=@AREAID
ORDER BY SUBAREANAME
END



