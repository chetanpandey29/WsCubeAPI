--UPDATECHECKLISTSETUP_1.0
DECLARE @CC_TIMESTAMP DATETIME
SET @CC_TIMESTAMP=GETDATE()

IF EXISTS(SELECT 1 FROM CHECKLISTSETUP WHERE CHECKLISTSETUPID!=@CHECKLISTSETUPID AND SETUPNAME=@SETUPNAME AND [STATUS]!=2 ) SELECT -1
ELSE
BEGIN
UPDATE CHECKLISTSETUP SET SETUPNAME=@SETUPNAME,ALLSITES=@ALLSITES,CATEGORYTYPE=1,
ALLSAFECHECK=@ALLSAFECHECK,STATUS=@STATUS,UPDATEDBY=@UPDATEDBY,UPDATEDDATE=@CC_TIMESTAMP,ENABLESAFEUNSAFE = @ENABLESAFEUNSAFE,ISMODIFIED=1 WHERE CHECKLISTSETUPID=@CHECKLISTSETUPID;SELECT 2
END

IF @ALLSITES= 1
DELETE FROM CHECKLISTSETUPSITES WHERE CHECKLISTSETUPID=@CHECKLISTSETUPID
ELSE IF @ALLSITES= 0 AND NOT EXISTS (SELECT 1 FROM CHECKLISTSETUPSITES WHERE CHECKLISTSETUPID=@CHECKLISTSETUPID AND SITEID=((SELECT DEFAULTSITEID FROM USERINFO WHERE USERID= @UPDATEDBY)) AND STATUS=1)
INSERT INTO CHECKLISTSETUPSITES(CHECKLISTSETUPID,SITEID,STATUS,UPDATEDBY,UPDATEDDATE)
SELECT @CHECKLISTSETUPID,(SELECT DEFAULTSITEID FROM USERINFO WHERE USERID= @UPDATEDBY),1,@UPDATEDBY,@CC_TIMESTAMP

INSERT INTO dbo.AUDIT(TABLENAME,TRANS,STAMP,LASTUPDATEDBY,DATA)
SELECT 'CHECKLISTSETUP','UPDATE-UPDATECHECKLISTSETUP_1.0',@CC_TIMESTAMP,@UPDATEDBY,
(SELECT * FROM CHECKLISTSETUP WHERE UPDATEDBY=@UPDATEDBY AND UPDATEDDATE=@CC_TIMESTAMP FOR XML AUTO)

INSERT INTO dbo.AUDIT(TABLENAME,TRANS,STAMP,LASTUPDATEDBY,DATA)
SELECT 'CHECKLISTSETUPSITES','UPDATE-UPDATECHECKLISTSETUP_1.0',@CC_TIMESTAMP,@UPDATEDBY,
(SELECT * FROM CHECKLISTSETUPSITES WHERE UPDATEDBY=@UPDATEDBY AND UPDATEDDATE=@CC_TIMESTAMP FOR XML AUTO)